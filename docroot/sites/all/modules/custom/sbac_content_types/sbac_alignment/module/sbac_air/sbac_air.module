<?php

/**
 * Implements hook_update_projects_alter().
 *
 * @param $projects
 */
function sbac_air_update_projects_alter(&$projects) {
  unset($projects['sbac_air']);
}

/**
 * Implements hook_menu().
 */
function sbac_air_menu() {
  $items = array();

  $items['sbac-air/test-data'] = array(
    'title' => 'Test Air API Data',
    'page callback' => 'sbac_air_test_data',
    'access arguments' => array('admin'),
    'type' => MENU_CALLBACK,
  );

  return $items;
}

/**
 * Callback function to test API data.
 *
 * @return string
 */
function sbac_air_test_data() {
  // module_load_include('inc', 'sbac_air', 'lib/sbac_air.airapiclient');
  // $airclient = new AIRAPIClient();

  // Main functions to test the data stream.
  // dsm($airclient->test_data('CC-ELA-v1'));
  // dsm($airclient->test_data('CC-MA-v1'));

  // More test functions if you need to verify certain aspects of the API data.
  // dsm($airclient->getSubjectsSBAC());
  // dsm($airclient->getStandards('SBAC-ELA-v1'));
  // dsm($status = $airclient->validate('SBAC-ELA-v1'));
  // dsm($airclient->validate('SBAC-MA-v1'));

  sbac_air_cron();
  return '';
}

/**
 * Implements hook_cron().
 *
 * Used to update CCSS Taxonomy terms on a nightly basis
 */
function sbac_air_cron() {
  $ccss_vocab_name = 'education_alignment';
  $publisher = 'CC';

  if (!($ccss_vocab = taxonomy_vocabulary_machine_name_load($ccss_vocab_name))) {
    return;
  }

  module_load_include('inc', 'sbac_air', 'sbac_air.cron');
  
  //  Update 'English / Language Arts'
  sbac_air_sync_ccss($ccss_vocab->vid, 'English / Language Arts', $publisher);
  //  Update 'Mathematics'
  sbac_air_sync_ccss($ccss_vocab->vid, 'Mathematics');
}
